<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تماريني — اسأل الذكاء الاصطناعي</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#0d0d0d; color:#fff; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; margin:0; padding-top:72px; }
    /* ثابت أعلى */
    header.fixed-top {
      position: fixed; top: 0; left: 0; right: 0;
      background: linear-gradient(90deg,#111827,#1f2937);
      color: #fef2f2;
      padding: 14px 20px;
      z-index: 1000;
      font-weight: 800;
      border-bottom: 2px solid rgba(248,113,113,0.07);
      text-align: center;
    }
    main.container { max-width:900px; margin: 30px auto; padding: 0 16px; }
    .card { background: #0f1724; border: 1px solid rgba(148,163,184,0.06); padding: 20px; border-radius: 12px; box-shadow: 0 6px 30px rgba(2,6,23,0.6); }
    textarea#q { width:100%; min-height:96px; resize:vertical; padding:12px; border-radius:8px; border:1px solid #334155; background:#e6edf7; color:#000; font-size:16px; }
    button.primary { width:100%; padding:12px; margin-top:12px; border-radius:10px; background: linear-gradient(135deg,#ef4444,#b91c1c); color:white; font-weight:700; border:none; cursor:pointer; }
    button.primary:active{ transform:scale(.997) }
    .resp { margin-top:14px; color:#e6eef8; background:#071025; padding:14px; border-radius:8px; min-height:70px; white-space:pre-wrap; }
    .small { color:#94a3b8; font-size:14px; margin-top:6px; }
    .footer-note { text-align:center; margin-top:18px; color:#9ca3af; font-size:13px; }
  </style>
</head>
<body>

  <header class="fixed-top">تم الصنع بواسطة رعد الأسود</header>

  <main class="container">
    <div class="card">
      <h1 class="text-2xl font-extrabold mb-2" style="color:#fb7185">💬 اسأل الذكاء الاصطناعي</h1>
      <p class="small">اكتب سؤالاً واحداً ثم اضغط إرسال — سيقوم الموقع بطلب إجابة من Hugging Face ويعرض النتيجة.</p>

      <textarea id="q" placeholder="اكتب سؤالك هنا... (مثال: كيف أبدأ نظام تمارين للمبتدئين؟)"></textarea>
      <button class="primary" id="askBtn">إرسال السؤال</button>

      <div class="resp" id="result">الجواب سيظهر هنا...</div>
      <div class="footer-note">ملاحظة: هذا اختبار مباشر مع موديل Hugging Face باستخدام التوكن الموجود في الكود.</div>
    </div>
  </main>

  <script>
    // === ضع توكن Hugging Face هنا (الذي زودتني به) ===
    const HF_TOKEN = "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";

    // اختر موديل موثوق: سأستخدم هنا "tiiuae/falcon-7b-instruct" كخيار شائع.
    // إذا واجهت مشاكل، يمكن تغييره إلى موديل آخر موجود في HF.
    const MODEL = "tiiuae/falcon-7b-instruct";

    const btn = document.getElementById("askBtn");
    const qEl = document.getElementById("q");
    const resEl = document.getElementById("result");

    btn.addEventListener("click", ask);

    async function ask() {
      const question = qEl.value.trim();
      if (!question) {
        resEl.textContent = "⚠️ الرجاء كتابة سؤال أولاً.";
        return;
      }

      // واجهة مستخدم: إشارة انتظار
      resEl.textContent = "⏳ جاري المعالجة — الرجاء الانتظار...";

      try {
        // نجهز موجه واضح بالعربية ليحسن جودة الإجابة
        const prompt = `أجب عن السؤال التالي باللغة العربية الواضحة والمختصرة:\n\n${question}`;

        // طلب POST إلى endpoint الخاص بـ Hugging Face Inference API
        const response = await fetch(`https://api-inference.huggingface.co/models/${MODEL}`, {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + HF_TOKEN,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            inputs: prompt,
            parameters: {
              max_new_tokens: 256,
              do_sample: false
            }
          })
        });

        // حاول تفريغ رد JSON
        const data = await response.json();
        console.log("HuggingFace response:", data);

        // إذا أعاد خطأ من السيرفر
        if (data.error) {
          resEl.textContent = "⚠️ حصل خطأ من خدمة Hugging Face: " + data.error;
          return;
        }

        // استخراج النص من صيغ مختلفة ممكنة
        let answer = "";

        // شائع: مصفوفة مع generated_text
        if (Array.isArray(data) && data[0]?.generated_text) {
          answer = data[0].generated_text;
        }
        // بعض النماذج تعيد كائن به generated_text
        else if (data.generated_text) {
          answer = data.generated_text;
        }
        // بعض النماذج قد ترجع key باسم 'output' أو 'output_text'
        else if (Array.isArray(data) && data[0]?.output_text) {
          answer = data[0].output_text;
        }
        else if (data[0]?.text) {
          answer = data[0].text;
        }
        // في حال لم نجد شكل معروف، حاول تحويل الى نص خام
        else {
          answer = JSON.stringify(data, null, 2);
        }

        // أزل السؤال إذا تم تكراره في البداية (بعض النماذج تُعيد prompt+answer)
        if (answer.startsWith(prompt)) {
          answer = answer.slice(prompt.length).trim();
        } else {
          // أحياناً الموديل يعيد السؤال ثم إجابة مختلفة - نحاول إزالة السؤال التقريبي
          const qShort = question.split('\n')[0];
          if (answer.includes(qShort)) {
            answer = answer.replace(qShort, "").trim();
          }
        }

        // أخيراً نعرض الإجابة أو رسالة ملائمة
        if (answer) {
          resEl.textContent = answer;
        } else {
          resEl.textContent = "⚠️ لم أستلم إجابة مفهومة من الموديل.";
        }

      } catch (err) {
        console.error("Request error:", err);
        // إذا كان خطأ CORS أو شبكي سنظهر رسالة مفيدة
        resEl.textContent = "❌ خطأ في الاتصال بالموديل. إذا ظهر خطأ CORS في الكونسول، تحتاج إلى تشغيل بروكسي أو وضع التوكن في خادم خلفي (backend). تفاصيل في الأسفل.";
      }
    }
  </script>
</body>
</html>
